<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>../tests/Handler.php</title>
  <link rel="stylesheet" href="../pyccoon.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'>
      <h1 id="breadcrumbs">/ <a href="Handler.php.html/../../index.html">.</a> / <a href="Handler.php.html/../index.html">tests</a> / <a href="Handler.php.html">Handler.php</a> </h1>
      <ul id="children"></ul>
    </div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="k">namespace</span> <span class="nx">Academy\Services\Notify\Handlers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Academy\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Academy\Services\Notify\Events\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Academy\Services\Notify\Events\EventFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Academy\Services\Notify\NotifyManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\Jobs\Job</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\QueueManager</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Class Handler</p>
<p><span class="pydoc pydoc-category"><span>category</span> <code>Classes</code></span> 
<span class="pydoc pydoc-package"><span>package</span> <code>Academy\Services\Notify\Handlers</code></span> 
<span class="pydoc pydoc-author"><span>author</span> <code>"Volodymr Kornilov"</code></span> &lt;mail@terion.name&gt;
<span class="pydoc pydoc-license"><span>license</span> <code>MIT</code></span> http://opensource.org/licenses/MIT
<span class="pydoc pydoc-link"><span>link</span> <code>http://terion.name</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">abstract</span> <span class="k">class</span> <span class="nc">Handler</span>
<span class="p">{</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      <p><span class="pydoc pydoc-var"><span>var</span> <code>NotifyManager</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="nv">$manager</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      <p><span class="pydoc pydoc-var"><span>var</span> <code>QueueManager</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="nv">$queue</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p><span class="pydoc pydoc-var"><span>var</span> <code>EventFactory</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="nv">$eventFactory</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      <p><span class="pydoc pydoc-var"><span>var</span> <code>\Academy\Models\User</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="nv">$user</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      <p><span class="pydoc pydoc-var"><span>var</span> <code>\Illuminate\Foundation\Application</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">private</span> <span class="nv">$app</span><span class="p">;</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>\Illuminate\Foundation\Application</code></span> $app
<span class="pydoc pydoc-param"><span>param</span> <code>NotifyManager</code></span> $manager
<span class="pydoc pydoc-param"><span>param</span> <code>EventFactory</code></span> $eventFactory
<span class="pydoc pydoc-param"><span>param</span> <code>QueueManager</code></span> $queue
<span class="pydoc pydoc-param"><span>param</span> <code>User</code></span> $user</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span>
        <span class="nx">Application</span> <span class="nv">$app</span><span class="p">,</span>
        <span class="nx">NotifyManager</span> <span class="nv">$manager</span><span class="p">,</span>
        <span class="nx">EventFactory</span> <span class="nv">$eventFactory</span><span class="p">,</span>
        <span class="nx">QueueManager</span> <span class="nv">$queue</span><span class="p">,</span>
        <span class="nx">User</span> <span class="nv">$user</span>
    <span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">manager</span> <span class="o">=</span> <span class="nv">$manager</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">queue</span> <span class="o">=</span> <span class="nv">$queue</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventFactory</span> <span class="o">=</span> <span class="nv">$eventFactory</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span> <span class="o">=</span> <span class="nv">$user</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span> <span class="o">=</span> <span class="nv">$app</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>$data</code></span> </p>
<p><span class="pydoc pydoc-return"><span>return</span> <code>mixed</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">abstract</span> <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>Job</code></span> $job
<span class="pydoc pydoc-param"><span>param</span> <code>$data</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">public</span> <span class="k">function</span> <span class="nf">notify</span><span class="p">(</span><span class="nx">Job</span> <span class="nv">$job</span><span class="p">,</span> <span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$job</span><span class="o">-&gt;</span><span class="na">attempts</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">list</span><span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="nv">$user</span><span class="p">)</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">restoreObjects</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">manager</span><span class="o">-&gt;</span><span class="na">notify</span><span class="p">(</span><span class="nv">$event</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="nv">$job</span><span class="o">-&gt;</span><span class="na">release</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>$data</code></span> </p>
<p><span class="pydoc pydoc-return"><span>return</span> <code>array</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">restoreObjects</span><span class="p">(</span><span class="nv">$data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">restoreEventObject</span><span class="p">(</span><span class="nx">array_get</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">)),</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">restoreUserObject</span><span class="p">(</span><span class="nx">array_get</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)),</span>
        <span class="p">];</span>
    <span class="p">}</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>$from</code></span> </p>
<p><span class="pydoc pydoc-throws"><span>throws</span> <code>\InvalidArgumentException</code></span> 
<span class="pydoc pydoc-return"><span>return</span> <code>Event</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">restoreEventObject</span><span class="p">(</span><span class="nv">$from</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$from</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="nv">$event</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">make</span><span class="p">(</span><span class="nx">array_get</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">));</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$event</span> <span class="nx">instanceof</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">setData</span><span class="p">(</span><span class="nx">array_get</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">[]));</span>
            <span class="k">return</span> <span class="nv">$event</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="o">!</span><span class="nv">$from</span> <span class="nx">instanceof</span> <span class="nx">Event</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$from</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
    </div>
    <div class='clearall'></div>
  </div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      <p><span class="pydoc pydoc-param"><span>param</span> <code>$from</code></span> </p>
<p><span class="pydoc pydoc-throws"><span>throws</span> <code>\InvalidArgumentException</code></span> 
<span class="pydoc pydoc-return"><span>return</span> <code>User</code></span> </p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">protected</span> <span class="k">function</span> <span class="nf">restoreUserObject</span><span class="p">(</span><span class="nv">$from</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$from</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$id</span> <span class="o">=</span> <span class="nx">array_get</span><span class="p">(</span><span class="nv">$from</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="o">!</span><span class="nv">$from</span> <span class="nx">instanceof</span> <span class="nx">User</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$from</span><span class="p">;</span>
    <span class="p">}</span>


<span class="p">}</span>

</pre></div>
    </div>
    <div class='clearall'></div>
  </div>
</div>
</body>